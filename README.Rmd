---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# op<b style='color:blue'>uy</b> <img src='man/figures/logo.png' align="right" height="180" />



*Nicolás Schmidt, Daniela Vairo, Martín Opertti, UMAD<sup><a id="fnr.1" class="footref" href="#fn.1">1</a></sup>.*

<!-- badges: start -->
[![CRAN status](https://www.r-pkg.org/badges/version/opuy)](https://CRAN.R-project.org/package=opuy)
[![R-CMD-check](https://github.com/Nicolas-Schmidt/opuy/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/Nicolas-Schmidt/opuy/actions/workflows/R-CMD-check.yaml)
[![Project Status: Active – The project has reached a stable, usable
state and is being actively
developed.](https://www.repostatus.org/badges/latest/active.svg)](https://www.repostatus.org/#active)
`r badger::badge_devel("Nicolas-Schmidt/opuy", "blue")`
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![DOI](https://zenodo.org/badge/253661638.svg)](https://zenodo.org/badge/latestdoi/253661638)


<!-- badges: end -->


> Datos de opinón pública de Uruguay de 1989 hasta la actualidad. 

### Descripción 

Provee un conjunto de datos de opinión publica en Uruguay para el periodo que va desde 1989 hasta la actualidad de dos indicadores relevante para el estudio de la realidad política del país: __intención de voto__ y __evaluación de gestión del presidente__.

El manual del paquete se puede encontrar [__aquí__](https://github.com/Nicolas-Schmidt/opuy/blob/master/man/figures/Manual_opuy.pdf).




### Instalación

``` r
remotes::install_github("Nicolas-Schmidt/opuy")
```

### Contenido del paquete


#### Funciones

| Nombre |Descripción |
| ----------------- | -------------------------------------------------------------- | 
|`resumen_opuy`|Resumen de los indicadores que contiene la base de datos por consultora y por año. Esta función  tiene asociado su propio método de `print()` y `summary()`. |


#### Conjuntos de datos

| Nombre |Descripción |
| ----------------- | -------------------------------------------------------------- | 
|`opuy`|Conjunto de datos que contiene dos indicadores de opinión pública relevante para trabajar con datos políticos para el período 1989 hasta la actualdiad: __Intención de voto__ y __Evaluación de la gestión del Presidente__. Los valores para ambos indicadores son agregados ya que no se cuenta con los microdatos.|





### Ejemplo

```{r}
## Conjunto de datos: 'opuy'

library(opuy)

summary(resumen_opuy())

resumen_opuy(polling.org = c("Equipos", "Cifra", "Factum", "Opcion"))

```

#### Intención de voto para elecciones nacionales medidas en 2019 por todas las consultoras

```{r, echo = FALSE,  message = FALSE, warning = FALSE}
library(extrafont)
```
```{r,  message = FALSE, warning = FALSE, fig.width=10, fig.height=6}
library(tidyverse)

data(opuy)

opuy %>%
    filter(medicion == 'Intencion de voto',
           tipo_eleccion == 'Nacional',
           anio_medicion == 2019, 
           sigla %in% c('FA', 'PC', 'PN', 'CA')) %>% 
    mutate(partido = factor(partido, levels = c('Frente Amplio', 'Partido Colorado', 
                                                'Partido Nacional', 'Cabildo Abierto'))) %>% 
    ggplot(aes(x = fecha, y = valor, color = empresa)) +
    geom_line(aes(group = empresa), size = 1, alpha = 0.6) +
    geom_point(size = 1.5) +
    facet_wrap(~partido, nrow = 1) +
    hrbrthemes::theme_ipsum_tw(grid = "XY", axis = "xy") +
    labs(x = "",
         y = "Porcentaje de votos %",
         color = "",
         title = "Intención de voto en elecciones nacionales 2019",
         subtitle = '27 de octubre de 2019 \nMediciones del año 2019',
         caption = 'Fuente: opuy (Schmidt et al. 2022)')


  

```


#### Intención de voto para elecciones nacionales de todas las consultoras para todo el período de medición de la elección de 2019 (2016 - 2019)



<img src='man/figures/iv2019.gif'/>


#### Resumen intención de voto 2019 de los principales partidos para toda la serie correspondiente a la elección nacional de 2019 (2016 - 2019)

```{r, echo = FALSE, message = FALSE}

library(magrittr)
library(dplyr)
library(Boreluy)
library(opuy)

e19  <- Boreluy::nacional_uy(eleccion = 2019) %>%
    select(Partido, Porcentaje) 
tab <- opuy %>%
    filter(medicion == 'Intencion de voto',
           tipo_eleccion == 'Nacional',
           eleccion == 2019,
           sigla %in% c('FA', 'PC', 'PN', 'CA')) %>%
    group_by(partido) %>%
    summarise('Valor Mínimo' = min(valor),
              'Valor Máximo' = max(valor), 
              'Valor Mínimo 2019' = min(valor[anio_medicion == 2019]),
              'Valor Máximo 2019' = max(valor[anio_medicion == 2019])) %>%
    ungroup() %>%
    rename(Partido = partido) %>%
    left_join(., e19, by = 'Partido') %>% 
    arrange(-Porcentaje) %>% 
    rename('Votación real' = Porcentaje) 

tab <- cbind(tab[,1], apply(tab[, -1], 2, function(x){paste0(substring(x, 1, 5), "%")}))

knitr::kable(tab)
```

#### Evaluación de la gestión del presidente 

```{r, fig.width=12, fig.height=5, message = FALSE, warning=FALSE}
opuy %>%
    filter(medicion == 'Evaluacion de gestion presidente',
           categoria_unificada == 3) %>%
    select(anio_gobierno, empresa, valor, presidente) %>%
    group_by(empresa, anio_gobierno, presidente) %>%
    summarise(promedio = mean(valor, na.rm = TRUE)) %>%
    ungroup() %>%
    mutate(presidente = factor(presidente, levels = c("Lacalle", "Sanguinetti 2", 
                                                      "Batlle", "Vazquez 1", "Mujica", 
                                                      "Vazquez 2", "Lacalle Pou"))) %>% 
    ggplot(aes(x = factor(anio_gobierno), y = promedio, color = empresa)) +
    geom_line(aes(group = empresa), size = 1, alpha = 0.6) +
    geom_point(size = 1.5) +
    facet_wrap(~presidente, nrow = 1) +
    hrbrthemes::theme_ipsum_tw(grid = "XY", axis = "xy") +
    labs(x = "Año de gobierno",
         y = "Porcentaje de aprobación",
         color = "", 
         title = "Evaluacion de la gestión del presidente",
         subtitle = 'Serie histórica con datos de todas las consultoras (promedios anuales)',
         caption = 'Fuente: opuy (Schmidt et al. 2022)')

```

#### Uso combinado del paquete `opuy` con [`Boreluy`](https://nicolas-schmidt.github.io/Boreluy/) (paquete de R de datos electorales de Uruguay)


La paleta grafica que se presenta contiene los datos de cuatro consultores sobre intención de voto de cara a la elección de octubre de 2019. La recta y el punto rojo indica el resultado que cada partido obtuvo en la elección. La franja roja horizontal se conforma con los puntos de la última intención de voto de cada consultora y el resultado de la elección. El número rojo arriba a la izquierda de cada grafico indica le distancia de la última estimación con el resultado de la elección.

```{r, fig.width=12, fig.height=10, message = FALSE, warning=FALSE, echo=FALSE}
source("data-raw/test.R")

```

```{r, echo = FALSE, message = FALSE, eval = F}
manual <- function(){
    old <- here::here()
    path <- here::here('man', 'figures')
    sink('noise.txt')
    devtools::build_manual(path = path)
    sink()
    setwd(path)
    invisible(file.rename(list.files(pattern="^opuy"), 'Manual_opuy.pdf'))
    setwd(old)
    invisible(file.remove('noise.txt'))
}
manual()
```


#### :bookmark_tabs: Citar

Para citar el uso de los datos o del paquete `opuy` en publicaciones use:

**Schmidt, Nicolás, Vairo, Daniela, Opertti, Martín , UMAD (2022) opuy: Datos de Opinión Pública de Uruguay 1989 a la actualidad, R package version 0.1.1001, https://nicolas-schmidt.github.io/opuy/.**








---

##### Mantenedor
Nicolás Schmidt (<nschmidt@cienciassociales.edu.uy>)






#### Notas

---
<sup><a id="fn.1" href="#fnr.1">1</a></sup> Unidad de Métodos y Acceso a Datos, Facultad de Ciencias Sociales, Universidad de la República (UMAD-FCS-UdelaR)

